{"componentChunkName":"component---src-templates-post-template-jsx","path":"/blog/code-coverage-of-e2e-tests-with-playwright/","result":{"data":{"site":{"siteMetadata":{"title":"ludeknovy.tech","subtitle":"Thoughts on testing and test automation","copyright":"© All rights reserved.","author":{"name":"","twitter":"#"},"disqusShortname":"","url":"https://wwww.ludeknovy.tech"}},"markdownRemark":{"id":"122053aa-cfbe-5309-954b-33016ed67216","html":"<p>I have been playing with Playwright for some time, and their documentation (they even have <a href=\"https://playwright.tech/blog/tracking-frontend-coverage-with-playwright\">blog post</a> about it) gave me an idea of measuring code coverage of E2E tests.</p>\n<h2>What is Playwright?</h2>\n<p>Playwright is one of the newest UI testing tool, which describes itself as a tool “to enable cross-browser web automation that is ever-green, capable, reliable and fast.” (Clearly they market itself as selenium competitor as selenium is often connected with terms like “unreliable” and “slow”) Playwright has great API, auto waits, multiple browser support (Chromium, WebKit, Firefox), intercepting networks, it supports automatic code coverage collection and more.</p>\n<h2>Why would I need a code coverage of E2E tests?</h2>\n<p>The code coverage metric is widely connected with unit tests. Primarily because it is easy to measure it for unit tests and every decent testing framework supports it out of the box. Code coverage is much less considered when talking about API tests or E2E tests. I bet the main reason is, that it is not so easy to get it - just try to google API code coverage and compare it unit code coverage. In the second case, Google returns many more results.</p>\n<p>Code coverage of E2E tests should not be used for dull 100% coverage goal (as with unit tests), since it may bring more problems than gain. But rather it should be used as an indicator. Indicator of whether we have not forgotten to cover any business critical scenario.</p>\n<h2>How do I get a code coverage?</h2>\n<p>I was using playwright together with Jest. The playwright community contains <a href=\"https://medium.com/r/?url=https%3A%2F%2Fgithub.com%2Fplaywright-community%2Fjest-playwright\">playwright-jest</a> template for jest framework. This allows you to create <code class=\"language-text\">jest-playwright.config.js</code> where you can set up all playwright settings. In our case, we want to set <code class=\"language-text\">collectCoverage</code> to <code class=\"language-text\">true</code>.</p>\n<p>Another thing which is needed to gather code coverage, is to instrument your app. In my case I had to install <code class=\"language-text\">babel-plugin-istanbul</code> and add to <code class=\"language-text\">.babelrc</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"env\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"istanbul\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Start your application in the development environment. To confirm you will be able to get coverage, go to console in dev tools, and type <code class=\"language-text\">__coverage__</code>. If you get an object, you are ready to collect code coverage with your E2E tests.</p>\n<p>Add new command to your <code class=\"language-text\">package.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"test:e2e\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nyc --reporter=html jest\"</span></code></pre></div>\n<p>You can choose whatever reporter you want. Istanbul provides plethoras of them.</p>\n<p>Type <code class=\"language-text\">npm run test:e2e</code>. And once your test execution finishes you should get console output like this:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/950ceba81aac28aa4464ca4243a45d8f/02b44/e2e_coverage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 960px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 43.75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8UlEQVQoz22RWW/TQBSF/d+ReOWJZ554QlRCQiCBkKhoaJI2u+M6zuIl3pfYcbzFafmYNEJ9YaSj880d6c6ZO1IQJFR1S1W11M3pmev6xPH4JPaPtO0f/q0X+j+fXToWa5piRZUvqQ8rIeGCT7VOW21oyhWt4FNt8HQ0eRR+YevZH5uX+lNjIsX5lry2qVqH4ijUnGVTHl3CXEPzeziJzC7XSQuT3UEnyTdkgs9+rmflhdODgbROdGRfYxGtMLMlcbUkKjV2jY4WdvihvEMNOiTVGiue4e1V/EzFjmXCwwI3U3BSRdQfsHdzJN0bI5t95uYdYdJnn/VJ0x55PsK0PtKdvGJjfyHd9XGca4KogxvfsA2uiZJbfP+GQFwYiMs99xeS4WiohsKD8SAOFZJIIQ4V0mTBetOhK3/Csu+IgjnOdkIUj/CTGzzRNIzG+K6M703xHCF3iqTFKmNfRonm2AcZt5RxihlhLerudz4M3zCwv+IVczbxAGc/wU1H4skXNnYjrGz8LCMZioZidmNXRY0WhOVFQaGS1Ctk7ydXo7eM7G9EhYYRT9jtpzTZPUXcEx8hs01FgOwiKxEJ1WjG0B0y9oaY+4FIOWCb3+OVU5HsM+/7r+maVzhipsvwN9vsTgz/Fiu68CbpiZR9dKF11OUvYE6UaSQn7oMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"E2E test code coverage report\"\n        title=\"E2E test code coverage report\"\n        src=\"/static/950ceba81aac28aa4464ca4243a45d8f/d9199/e2e_coverage.png\"\n        srcset=\"/static/950ceba81aac28aa4464ca4243a45d8f/8ff5a/e2e_coverage.png 240w,\n/static/950ceba81aac28aa4464ca4243a45d8f/e85cb/e2e_coverage.png 480w,\n/static/950ceba81aac28aa4464ca4243a45d8f/d9199/e2e_coverage.png 960w,\n/static/950ceba81aac28aa4464ca4243a45d8f/07a9c/e2e_coverage.png 1440w,\n/static/950ceba81aac28aa4464ca4243a45d8f/29114/e2e_coverage.png 1920w,\n/static/950ceba81aac28aa4464ca4243a45d8f/02b44/e2e_coverage.png 3358w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>This report reminds us, that there is one area of the application which is not covered by E2E tests at all. And it’s up to further risk consideration whether it should or not to be included in E2E test suite.</p>","fields":{"tagSlugs":["/tags/e-2-e/","/tags/playwright/"],"slug":"/blog/code-coverage-of-e2e-tests-with-playwright/"},"frontmatter":{"title":"Code coverage of E2E with Playwright","tags":["e2e","playwright"],"date":"2020-09-19T02:46:37.121Z","description":"Tutorial on how to collect code coverage of E2E tests"}}},"pageContext":{"slug":"/blog/code-coverage-of-e2e-tests-with-playwright/"}},"staticQueryHashes":[]}